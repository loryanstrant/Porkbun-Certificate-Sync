<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porkbun Certificate Sync</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>üîê Porkbun Certificate Sync</h1>
                    <p>Manage SSL certificates from Porkbun</p>
                </div>
                <button id="dark-mode-toggle" class="dark-mode-btn" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
                    <span id="dark-mode-icon">üåô</span>
                </button>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-button active" onclick="openTab('settings')">‚öôÔ∏è Settings</button>
            <button class="tab-button" onclick="openTab('domains')">üåê Domains</button>
            <button class="tab-button" onclick="openTab('distribution')">üöÄ Distribution</button>
            <button class="tab-button" onclick="openTab('logs')">üìã Logs</button>
            <button class="tab-button" onclick="openTab('sync')">üîÑ Sync</button>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content active">
            <div class="section">
                <h2>API Configuration</h2>
                <form id="api-form">
                    <div class="form-group">
                        <label for="api_key">API Key:</label>
                        <input type="text" id="api_key" name="api_key" required>
                    </div>
                    <div class="form-group">
                        <label for="secret_key">Secret Key:</label>
                        <input type="password" id="secret_key" name="secret_key" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save API Credentials</button>
                </form>
            </div>

            <div class="section">
                <h2>Certificate Configuration</h2>
                <form id="cert-form">
                    <div class="form-group">
                        <label for="output_dir">Output Directory:</label>
                        <input type="text" id="output_dir" name="output_dir" value="/app/certificates">
                    </div>
                    <div class="form-group">
                        <label for="naming_format">Naming Format:</label>
                        <input type="text" id="naming_format" name="naming_format" value="{domain}" 
                               placeholder="Use {domain} for domain name">
                    </div>
                    <div class="form-group">
                        <label>Certificate Formats:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="format" value="pem" checked> PEM</label>
                            <label><input type="checkbox" name="format" value="crt"> CRT</label>
                            <label><input type="checkbox" name="format" value="key"> KEY</label>
                            <label><input type="checkbox" name="format" value="pfx"> PFX/PKCS12</label>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Certificate Settings</button>
                </form>
            </div>

            <div class="section">
                <h2>Schedule Configuration</h2>
                <form id="schedule-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="schedule_enabled" name="enabled">
                            Enable Automatic Sync
                        </label>
                    </div>
                    <div class="form-group">
                        <label for="frequency">Frequency:</label>
                        <select id="frequency" name="frequency">
                            <option value="hourly">Hourly</option>
                            <option value="daily" selected>Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="specific_days">Specific Days</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    <div class="form-group" id="day_of_week_group" style="display: none;">
                        <label for="day_of_week">Day of Week:</label>
                        <select id="day_of_week" name="day_of_week">
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                    </div>
                    <div class="form-group" id="specific_days_group" style="display: none;">
                        <label>Days of Week:</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" name="day" value="0"> Sun</label>
                            <label><input type="checkbox" name="day" value="1"> Mon</label>
                            <label><input type="checkbox" name="day" value="2"> Tue</label>
                            <label><input type="checkbox" name="day" value="3"> Wed</label>
                            <label><input type="checkbox" name="day" value="4"> Thu</label>
                            <label><input type="checkbox" name="day" value="5"> Fri</label>
                            <label><input type="checkbox" name="day" value="6"> Sat</label>
                        </div>
                    </div>
                    <div class="form-group" id="day_of_month_group" style="display: none;">
                        <label for="day_of_month">Day of Month:</label>
                        <input type="number" id="day_of_month" name="day_of_month" min="1" max="31" value="1">
                    </div>
                    <div class="form-group" id="time_group">
                        <label>Time:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <select id="hour" name="hour" style="width: 100px;">
                                <option value="0">00</option>
                                <option value="1">01</option>
                                <option value="2" selected>02</option>
                                <option value="3">03</option>
                                <option value="4">04</option>
                                <option value="5">05</option>
                                <option value="6">06</option>
                                <option value="7">07</option>
                                <option value="8">08</option>
                                <option value="9">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                            </select>
                            <span>:</span>
                            <select id="minute" name="minute" style="width: 100px;">
                                <option value="0" selected>00</option>
                                <option value="15">15</option>
                                <option value="30">30</option>
                                <option value="45">45</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cron_preview">Cron Expression:</label>
                        <input type="text" id="cron_preview" readonly style="background: #f0f0f0;">
                        <small>Preview of the cron schedule</small>
                    </div>
                    <button type="submit" class="btn btn-primary">Save Schedule Settings</button>
                </form>
            </div>
        </div>

        <!-- Domains Tab -->
        <div id="domains" class="tab-content">
            <div class="section">
                <h2 id="domain-form-title">Add Domain</h2>
                <form id="domain-form">
                    <input type="hidden" id="edit_mode" value="false">
                    <input type="hidden" id="original_domain" value="">
                    <div class="form-group">
                        <label for="domain">Domain:</label>
                        <input type="text" id="domain" name="domain" required placeholder="example.com">
                    </div>
                    <div class="form-group">
                        <label for="custom_name">Custom Base Name (optional):</label>
                        <input type="text" id="custom_name" name="custom_name" placeholder="my-cert">
                        <small>Base name used for certificate files (defaults to domain name)</small>
                    </div>
                    <div class="form-group">
                        <label for="separator">File Name Separator:</label>
                        <select id="separator" name="separator">
                            <option value="_">Underscore (_)</option>
                            <option value="-">Hyphen (-)</option>
                            <option value=".">Dot (.)</option>
                        </select>
                        <small>Separator used in file names (e.g., domain_cert.pem or domain.cert.pem)</small>
                    </div>
                    <div class="form-group">
                        <label for="alt_file_names">Alternative File Names (optional, comma-separated):</label>
                        <input type="text" id="alt_file_names" name="alt_file_names" placeholder="domain, production">
                        <small>Additional file name variants to save certificates as (e.g., "domain" will save as domain.cert.pem)</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary" id="domain-submit-btn">Add Domain</button>
                        <button type="button" class="btn" id="cancel-edit-btn" style="display: none; background: #95a5a6; color: white;" onclick="cancelEditDomain()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="section">
                <h2>Configured Domains</h2>
                <div id="domains-list">
                    <p class="loading">Loading domains...</p>
                </div>
            </div>
        </div>

        <!-- Distribution Tab -->
        <div id="distribution" class="tab-content">
            <div class="section">
                <h2 id="ssh-host-form-title">Add SSH Host</h2>
                <form id="ssh-host-form">
                    <input type="hidden" id="ssh_edit_mode" value="false">
                    <input type="hidden" id="ssh_original_display_name" value="">
                    <div class="form-group">
                        <label for="ssh_display_name">Display Name:</label>
                        <input type="text" id="ssh_display_name" name="display_name" required placeholder="Production Server">
                        <small>Friendly name for this host</small>
                    </div>
                    <div class="form-group">
                        <label for="ssh_hostname">Hostname/IP Address:</label>
                        <input type="text" id="ssh_hostname" name="hostname" required placeholder="server.example.com or 192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="ssh_port">SSH Port:</label>
                        <input type="number" id="ssh_port" name="port" value="22" min="1" max="65535" required>
                    </div>
                    <div class="form-group">
                        <label for="ssh_username">Username:</label>
                        <input type="text" id="ssh_username" name="username" required placeholder="root">
                    </div>
                    <div class="form-group">
                        <label for="ssh_password">Password:</label>
                        <input type="password" id="ssh_password" name="password" placeholder="Enter password">
                        <small id="password-hint">Required for new hosts. Leave empty to keep existing password when editing.</small>
                    </div>
                    <div class="form-group">
                        <label for="ssh_cert_path">Certificate Path:</label>
                        <input type="text" id="ssh_cert_path" name="cert_path" required placeholder="/etc/ssl/certs">
                        <small>Remote directory where certificates will be stored</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ssh_use_sudo" name="use_sudo">
                            Use sudo for file operations
                        </label>
                        <small>Enable this if the user doesn't have direct write permissions to the certificate path</small>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary" id="ssh-host-submit-btn">Add SSH Host</button>
                        <button type="button" class="btn" id="cancel-ssh-edit-btn" style="display: none; background: #95a5a6; color: white;" onclick="cancelEditSSHHost()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="section">
                <h2>Configured SSH Hosts</h2>
                <div id="ssh-hosts-list">
                    <p class="loading">Loading SSH hosts...</p>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <div class="section">
                <h2>Distribution Logs</h2>
                <div class="log-filters">
                    <label for="log-filter">Filter:</label>
                    <select id="log-filter" onchange="loadDistributionLogs()">
                        <option value="">All Events</option>
                        <option value="certificate_sync">Certificate Syncs</option>
                        <option value="certificate_distribution">Certificate Distributions</option>
                        <option value="bulk_distribution">Bulk Distributions</option>
                    </select>
                    <button class="btn" onclick="loadDistributionLogs()" style="margin-left: 10px;">üîÑ Refresh</button>
                </div>
                <div id="log-stats" class="log-stats">
                    <p class="loading">Loading statistics...</p>
                </div>
                <div id="distribution-logs">
                    <p class="loading">Loading logs...</p>
                </div>
            </div>
        </div>

        <!-- Sync Tab -->
        <div id="sync" class="tab-content">
            <div class="section">
                <h2>Manual Sync</h2>
                <button id="sync-button" class="btn btn-primary btn-large" onclick="triggerSync()">
                    üîÑ Sync All Certificates Now
                </button>
            </div>

            <div class="section">
                <h2>Sync Status</h2>
                <div id="sync-status">
                    <p class="loading">Loading status...</p>
                </div>
            </div>

            <div class="section">
                <h2>Last Sync Results</h2>
                <div id="sync-results">
                    <p class="loading">No sync results yet</p>
                </div>
            </div>
        </div>

        <footer>
            <p>Porkbun Certificate Sync | <a href="https://github.com/loryanstrant/Porkbun-Certificate-Sync" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <div id="notification" class="notification"></div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
